# 연쇄 이벤트 시스템 (Cascade Module) 아키텍처

## 개요

연쇄 이벤트 시스템은 Chickmaster 게임에서 하나의 이벤트가 발생했을 때 연쇄적으로 다른 이벤트들이 발생하는 메커니즘을 구현합니다. 이 시스템은 헥사고날 아키텍처의 도메인 확장 방식으로 구현되어 기존 코어 도메인과 통합되면서도 독립적인 책임을 갖습니다.

## 아키텍처 구조

연쇄 이벤트 시스템은 다음과 같은 헥사고날 아키텍처 계층으로 구성됩니다:

### 1. 도메인 레이어 (Domain Layer)

**위치**: `src/core/domain/cascade/`

도메인 레이어는 연쇄 이벤트 시스템의 핵심 비즈니스 로직과 규칙을 포함합니다. 모든 도메인 객체는 불변(immutable) 객체로 구현되어 있습니다.

주요 도메인 객체:
- `CascadeType`: 연쇄 이벤트 유형 (즉시, 지연, 조건부, 확률적)
- `TriggerCondition`: 이벤트 트리거 조건
- `PendingEvent`: 지연 처리될 이벤트 정보
- `CascadeNode`: 연쇄 체인 내 개별 노드
- `CascadeChain`: 연쇄 이벤트 체인
- `CascadeResult`: 연쇄 이벤트 처리 결과

### 2. 포트 레이어 (Port Layer)

**위치**: `src/core/ports/`

포트 레이어는 도메인 레이어와 외부 세계 사이의 인터페이스를 정의합니다.

주요 인터페이스:
- `ICascadeService`: 연쇄 이벤트 처리 인터페이스
- `IEventService`: 이벤트 서비스 인터페이스 (외부 의존성)

### 3. 어댑터 레이어 (Adapter Layer)

**위치**: `src/adapters/services/`

어댑터 레이어는 포트 인터페이스의 구현체를 제공합니다.

주요 구현체:
- `CascadeServiceImpl`: ICascadeService 구현체

## 의존성 방향

헥사고날 아키텍처의 원칙에 따라 모든 의존성은 내부(도메인)를 향합니다:

```
어댑터 → 포트 → 도메인
```

## 주요 기능

1. **연쇄 관계 등록**: 이벤트 간 연쇄 관계를 등록하고 관리
2. **연쇄 이벤트 처리**: 트리거 이벤트 발생 시 연쇄 이벤트 처리
3. **지연 이벤트 관리**: 특정 시간 후 발생하는 이벤트 관리
4. **조건부 이벤트 처리**: 특정 조건 만족 시 발생하는 이벤트 처리
5. **확률적 이벤트 처리**: 확률에 따라 발생하는 이벤트 처리
6. **사이클 감지**: 무한 루프 방지를 위한 사이클 감지
7. **영향도 계산**: 연쇄 이벤트의 게임 지표 영향도 계산

## 설계 원칙

1. **불변성 (Immutability)**: 모든 도메인 객체는 `@dataclass(frozen=True)`로 구현되어 불변성 보장
2. **단일 책임 (Single Responsibility)**: 각 클래스는 명확한 단일 책임을 가짐
3. **의존성 역전 (Dependency Inversion)**: 구체적인 구현보다 추상화에 의존
4. **도메인 주도 설계 (Domain-Driven Design)**: 비즈니스 도메인 개념을 중심으로 설계
5. **테스트 용이성 (Testability)**: 모든 컴포넌트는 독립적으로 테스트 가능

## 트레이드오프 및 불확실성

1. **성능 vs 불변성**: 불변 객체 사용으로 인한 객체 생성 오버헤드와 안전성 간의 tradeoff
2. **복잡성 vs 유연성**: 다양한 연쇄 유형 지원으로 인한 복잡성 증가와 유연성 간의 noRightAnswer
3. **메모리 사용 vs 처리 속도**: 연쇄 관계 캐싱과 실시간 계산 간의 uncertainty

## 통합 지점

1. **이벤트 엔진 (M-3)**: 이벤트 발생 시 연쇄 이벤트 처리 요청
2. **스토리텔러 (M-4)**: 스토리 흐름에 따른 연쇄 이벤트 제안
3. **메트릭 트래커 (M-2)**: 연쇄 이벤트로 인한 지표 변화 추적

## 향후 개선 방향

1. **성능 최적화**: 대규모 연쇄 체인 처리 시 성능 개선
2. **이벤트 템플릿**: 일반적인 연쇄 패턴을 위한 템플릿 시스템
3. **시각화 도구**: 연쇄 관계 시각화 도구 개발
4. **분석 기능**: 연쇄 효과 시뮬레이션 및 분석 기능
