# ADR-0001: 헥사고널 아키텍처 채택

## 상태

✅ **Accepted**

## 날짜

2024-01-15

## 작성자

- 개발팀 ([프로젝트 메인테이너])

## 맥락 (Context)

Chicken-RNG 게임 개발 시작 단계에서 아키텍처 패턴을 선택해야 했습니다. 게임은 복잡한 비즈니스 로직(경제 시스템, 이벤트 엔진, 메트릭 관리)을 가지고 있으며, 향후 UI, 저장소, 외부 서비스 등 다양한 어댑터가 필요할 것으로 예상되었습니다.

### 문제 정의
- 복잡한 게임 로직을 외부 시스템과 분리해야 함
- 테스트 가능한 구조 필요
- 향후 UI 변경 또는 저장소 교체에 유연하게 대응 필요
- 도메인 로직의 순수성 보장 필요

### 제약사항
- Python 3.12+ 환경
- 팀의 아키텍처 패턴 학습 비용
- 초기 개발 속도 vs 장기 유지보수성 트레이드오프

## 고려된 옵션들 (Considered Options)

### 옵션 1: 레이어드 아키텍처 (Layered Architecture)
**장점:**
- 팀에 익숙한 패턴
- 구현이 단순함
- 빠른 초기 개발 가능

**단점:**
- 상위 레이어가 하위 레이어에 의존하여 테스트가 어려움
- 도메인 로직이 인프라에 의존할 위험
- 순환 의존성 발생 가능

### 옵션 2: 헥사고널 아키텍처 (Ports & Adapters)
**장점:**
- 도메인 로직 완전 격리
- 높은 테스트 가능성
- 외부 시스템 교체 용이
- 의존성 방향이 명확함 (내부 지향)

**단점:**
- 초기 학습 비용 존재
- 보일러플레이트 코드 증가
- 작은 프로젝트에는 과도할 수 있음

### 옵션 3: MVC 패턴
**장점:**
- 웹 개발에 익숙한 패턴
- 프레임워크 지원 풍부

**단점:**
- 게임 로직에 적합하지 않음
- 비즈니스 로직 분산 위험
- 복잡한 상태 관리 어려움

## 결정 (Decision)

**선택한 옵션:** 헥사고널 아키텍처 (Ports & Adapters)

**결정 이유:**
1. **도메인 순수성**: 게임의 핵심 철학인 "정답 없음", "트레이드오프" 등의 비즈니스 로직을 외부 시스템으로부터 완전히 격리
2. **테스트 가능성**: 복잡한 게임 로직을 격리된 환경에서 테스트할 수 있어 품질 보장
3. **확장성**: 향후 다양한 UI(웹, 모바일), 저장소(파일, DB), 외부 서비스 연동이 필요한 상황에 유연하게 대응
4. **의존성 명확성**: 의존성이 항상 내부로 향하므로 코드 이해와 유지보수가 용이

**기대 효과:**
- 높은 코드 품질과 테스트 커버리지 달성
- 외부 시스템 변경 시 도메인 로직 영향 최소화

## 결과 (Consequences)

### 긍정적 영향
- 도메인 모델이 순수하게 유지됨 (외부 의존성 없음)
- 단위 테스트 작성이 매우 용이해짐
- 각 레이어의 책임이 명확하게 분리됨
- 새로운 어댑터 추가가 기존 코드에 영향 없이 가능

### 부정적 영향  
- 초기 코드 작성량이 증가함 (인터페이스 정의 필요)
- 팀의 학습 곡선 존재
- 작은 기능도 여러 레이어를 거쳐야 함

### 중립적 영향
- 코드 구조가 더 엄격해짐
- 디렉토리 구조가 복잡해짐

## 구현 계획 (Implementation)

### 필요한 작업
- [x] 핵심 디렉토리 구조 설계 (`src/core`, `src/adapters`, `src/application`)
- [x] 도메인 엔티티 정의 (불변 객체로 구현)
- [x] 포트 인터페이스 정의
- [x] 기본 어댑터 구현
- [x] 의존성 주입 컨테이너 설정

### 마일스톤
- [x] 기본 구조 완료: 2024-01-20
- [x] 첫 번째 도메인 서비스 구현: 2024-01-25
- [x] 구조 검증 스크립트 작성: 2024-01-30

### 위험 요소
- 팀 적응 지연 (확률: 중간, 영향: 낮음) - 문서화와 가이드로 해결
- 초기 개발 속도 저하 (확률: 높음, 영향: 낮음) - 장기적 이익이 더 큼

## 검증 방법 (Validation)

### 성공 지표
- 도메인 레이어의 외부 의존성 0%
- 단위 테스트 커버리지 80% 이상
- 새 어댑터 추가 시 도메인 코드 변경 없음

### 검증 방법
- `scripts/validate_architecture.py`로 의존성 방향 검증
- 테스트 커버리지 자동 측정
- 코드 리뷰 체크리스트에 아키텍처 준수 포함

### 롤백 계획
만약 이 결정이 잘못되었다면:
1. 롤백 조건: 개발 속도가 심각하게 저하되고 팀 적응이 어려운 경우
2. 롤백 절차: 레이어드 아키텍처로 전환, 도메인 코드는 최대한 보존
3. 대안 계획: 심플한 MVC 패턴으로 우선 MVP 완성 후 재검토

## 관련 문서

- [ADR-0002](./0002-immutable-domain-objects.md) - 불변 도메인 객체 패턴
- [아키텍처 명세](../architecture_specification.md)
- [구조 검증 스크립트](../../scripts/validate_architecture.py)

## 노트

### 토론 요약
- 초기 개발 속도 vs 장기 유지보수성에 대한 논의가 있었음
- 팀 학습 비용을 고려했지만, 충분한 문서화로 해결 가능하다고 판단
- 게임의 복잡성을 고려할 때 구조적 투자가 필요하다는 데 합의

### 참고 자료
- [헥사고널 아키텍처 원문](https://alistair.cockburn.us/hexagonal-architecture/)
- [Clean Architecture by Robert Martin](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [Ports & Adapters 구현 가이드](https://herbertograca.com/2017/09/14/ports-adapters-architecture/) 